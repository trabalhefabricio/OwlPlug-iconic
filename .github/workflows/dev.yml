name: Owlplug Dev

on: 
  push:
    branches:
      - '**'
      - '!master'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v6
    - name: Set up JDK 25
      uses: actions/setup-java@v5
      with:
        distribution: 'adopt'
        java-version: 25
        cache: 'maven'
    - name: Build maven parent project
      run: mvn -B install -DskipTests
    - name: Run Test
      run: mvn test
    - name: Build client JAR
      run: cd owlplug-client && mvn -B spring-boot:repackage -DskipTests
    - name: Get project version
      run: echo "version=$(mvn -q -Dexec.executable=echo -Dexec.args='${project.version}' --non-recursive exec:exec)" >> $GITHUB_ENV
    - name: Upload JAR artifact
      uses: actions/upload-artifact@v6
      with:
        name: owlplug-client-jar-dev
        path: owlplug-client/target/owlplug-client-*.jar
        if-no-files-found: warn
